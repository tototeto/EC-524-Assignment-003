"0","set.seed(981598345)"
"0","# Reload data"
"0","data('penguins')"
"0",""
"0","# Define Recipe"
"0",""
"0","rec_1 <- recipe(penguins, species ~ island + sex + bill_length_mm) %>% "
"0","  step_impute_mean(all_numeric()) %>% "
"0","  step_impute_mode(all_factor()) %>% "
"0","  update_role(species, new_role = ""outcome"")"
"0",""
"0","# Define Model"
"0",""
"0","mod_1 <- decision_tree("
"0","  mode = ""classification"","
"0","  engine = ""rpart"","
"0","  cost_complexity = tune(),"
"0","  tree_depth = tune(),"
"0","  min_n = tune()"
"0",")"
"0",""
"0","# Define Workflow"
"0",""
"0","wkfl_1 <- workflow() %>% "
"0","  add_model(mod_1) %>% "
"0","  add_recipe(rec_1)"
"0",""
"0","# Cross Validation sets"
"0","nfold = 5"
"0","peng_cv <- rec_1 %>% prep %>% juice %>% vfold_cv(v = nfold)"
"0",""
"0","# Parameter ranges"
"0",""
"0","cost_comp = 10^seq(from = -6, to = 0, by = 0.5)"
"0","depth = seq(from = 1, to = 15, by = 1)"
"0","mn = seq(from = 1, to = 10, by = 2)"
"0",""
"0","# Parellel"
"0",""
"0","tgrid <- expand_grid("
"0","      cost_complexity = cost_comp,"
"0","      tree_depth = depth,"
"0","      min_n = mn)"
"0",""
"0","# rf_tuning = mclapply("
"0","#   x = 1:nrow(tgrid),"
"0","#   FUN "
"0","# )"
"0",""
"0","# cross validate"
"0",""
"0","# Detect the number of available cores"
"0","num_cores <- detectCores()"
"0",""
"0","# Register parallel backend"
"0","cl <- makeCluster(num_cores - 1)"
"0","registerDoParallel(cl)"
"0",""
"0","cv <- wkfl_1 %>% "
"0","  tune_grid("
"0","    peng_cv,"
"0","    grid = tgrid,"
"0","    metrics = metric_set(accuracy),"
"0","    control = control_grid(save_pred = TRUE, verbose = TRUE, parallel_over = ""everything"") # Parellel"
"0","  )"
"0",""
"0","show_best(cv)"
