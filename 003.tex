% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={003},
  pdfauthor={Tom Ben-Shahar},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{003}
\author{Tom Ben-Shahar}
\date{March 3, 2025}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load packages}
\FunctionTok{library}\NormalTok{(pacman)}
\FunctionTok{p\_load}\NormalTok{(palmerpenguins, tidymodels, tidyverse, magrittr, skimr, DescTools, collapse, janitor, rpart, rpart.plot, doParallel)}
\FunctionTok{library}\NormalTok{(tidymodels)}
\CommentTok{\# Load the penguin data}
\FunctionTok{data}\NormalTok{(}\StringTok{\textquotesingle{}penguins\textquotesingle{}}\NormalTok{)}

\NormalTok{penguins }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{clean\_names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\section{Data Cleaning}\label{data-cleaning}

\subsubsection{Use skimr to check out the data. How many species do we
have? Are they fairly balanced in the data? Why does it
matter?}\label{use-skimr-to-check-out-the-data.-how-many-species-do-we-have-are-they-fairly-balanced-in-the-data-why-does-it-matter}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{skim}\NormalTok{(penguins)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ll@{}}
\caption{Data summary}\tabularnewline
\toprule\noalign{}
\endfirsthead
\endhead
\bottomrule\noalign{}
\endlastfoot
Name & penguins \\
Number of rows & 344 \\
Number of columns & 7 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Column type frequency: & \\
factor & 3 \\
numeric & 4 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Group variables & None \\
\end{longtable}

\textbf{Variable type: factor}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1687}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1205}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1687}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.0964}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1084}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.3373}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
ordered
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_unique
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
top\_counts
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
species & 0 & 1.00 & FALSE & 3 & Ade: 152, Gen: 124, Chi: 68 \\
island & 0 & 1.00 & FALSE & 3 & Bis: 168, Dre: 124, Tor: 52 \\
sex & 11 & 0.97 & FALSE & 2 & mal: 168, fem: 165 \\
\end{longtable}

\textbf{Variable type: numeric}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1000}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1400}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0600}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
mean
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
sd
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p0
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p25
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p50
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p75
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p100
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
hist
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
bill\_length\_mm & 2 & 0.99 & 43.92 & 5.46 & 32.1 & 39.23 & 44.45 & 48.5
& 59.6 & ▃▇▇▆▁ \\
bill\_depth\_mm & 2 & 0.99 & 17.15 & 1.97 & 13.1 & 15.60 & 17.30 & 18.7
& 21.5 & ▅▅▇▇▂ \\
flipper\_length\_mm & 2 & 0.99 & 200.92 & 14.06 & 172.0 & 190.00 &
197.00 & 213.0 & 231.0 & ▂▇▃▅▂ \\
body\_mass\_g & 2 & 0.99 & 4201.75 & 801.95 & 2700.0 & 3550.00 & 4050.00
& 4750.0 & 6300.0 & ▃▇▆▃▂ \\
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(penguins, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"cyan4"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Number of Penguins by Species"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Species"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Count"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{003_files/figure-latex/DataClean1-1.pdf}

Penguins species are not equally represented in the data, with some
species having more than twice as many observations as others.

\subsubsection{What is imputation?}\label{what-is-imputation}

Imputation is the process for handling missing data in which the values
missing are replaced with guesses based on similar data points.

\subsubsection{Hopefully you noticed we have some missing data. Let's
impute. By hand. Since we're doing it by hand, let's start simply. For
categorical variables, you can use the modal class. For numeric, let's
use the
median.}\label{hopefully-you-noticed-we-have-some-missing-data.-lets-impute.-by-hand.-since-were-doing-it-by-hand-lets-start-simply.-for-categorical-variables-you-can-use-the-modal-class.-for-numeric-lets-use-the-median.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pen\_imp\_hand }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# Numeric}
    \AttributeTok{bill\_length\_mm =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(bill\_length\_mm), }\FunctionTok{mean}\NormalTok{(bill\_length\_mm, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), bill\_length\_mm),}
    \AttributeTok{bill\_depth\_mm =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(bill\_depth\_mm), }\FunctionTok{mean}\NormalTok{(bill\_depth\_mm, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), bill\_depth\_mm),}
    \AttributeTok{flipper\_length\_mm =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(flipper\_length\_mm), }\FunctionTok{mean}\NormalTok{(flipper\_length\_mm, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), flipper\_length\_mm),}
    \AttributeTok{body\_mass\_g =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(body\_mass\_g), }\FunctionTok{mean}\NormalTok{(body\_mass\_g, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), body\_mass\_g),}
    
    \CommentTok{\# Categorical}
    \AttributeTok{sex =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(sex), }\FunctionTok{Mode}\NormalTok{(sex, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{), sex),}
    \AttributeTok{species =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(species), }\FunctionTok{Mode}\NormalTok{(species, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{), species),}
    \AttributeTok{island =} \FunctionTok{if\_else}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(island), }\FunctionTok{Mode}\NormalTok{(island, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{), island)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\subsubsection{Now repeat using tidymodels. Make a recipe and then prep
and bake it. Check out the
objects!}\label{now-repeat-using-tidymodels.-make-a-recipe-and-then-prep-and-bake-it.-check-out-the-objects}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rec\_imp }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(penguins) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{step\_impute\_mean}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{step\_impute\_mode}\NormalTok{(}\FunctionTok{all\_factor}\NormalTok{())}

\NormalTok{pen\_imp\_tidy }\OtherTok{\textless{}{-}}\NormalTok{ rec\_imp }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{prep}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{juice}\NormalTok{()}

\NormalTok{rec\_imp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
\end{verbatim}

\begin{verbatim}
## -- Recipe ----------------------------------------------------------------------
\end{verbatim}

\begin{verbatim}
## 
\end{verbatim}

\begin{verbatim}
## -- Inputs
\end{verbatim}

\begin{verbatim}
## Number of variables by role
\end{verbatim}

\begin{verbatim}
## undeclared role: 7
\end{verbatim}

\begin{verbatim}
## 
\end{verbatim}

\begin{verbatim}
## -- Operations
\end{verbatim}

\begin{verbatim}
## * Mean imputation for: all_numeric()
\end{verbatim}

\begin{verbatim}
## * Mode imputation for: all_factor()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{skim}\NormalTok{(pen\_imp\_tidy)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ll@{}}
\caption{Data summary}\tabularnewline
\toprule\noalign{}
\endfirsthead
\endhead
\bottomrule\noalign{}
\endlastfoot
Name & pen\_imp\_tidy \\
Number of rows & 344 \\
Number of columns & 7 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Column type frequency: & \\
factor & 3 \\
numeric & 4 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Group variables & None \\
\end{longtable}

\textbf{Variable type: factor}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1687}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1205}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1687}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.0964}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.1084}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 10\tabcolsep) * \real{0.3373}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
ordered
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_unique
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
top\_counts
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
species & 0 & 1 & FALSE & 3 & Ade: 152, Gen: 124, Chi: 68 \\
island & 0 & 1 & FALSE & 3 & Bis: 168, Dre: 124, Tor: 52 \\
sex & 0 & 1 & FALSE & 2 & mal: 179, fem: 165 \\
\end{longtable}

\textbf{Variable type: numeric}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1000}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1400}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0800}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0700}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0600}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
mean
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
sd
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p0
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p25
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p50
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p75
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p100
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
hist
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
bill\_length\_mm & 0 & 1 & 43.92 & 5.44 & 32.1 & 39.27 & 44.25 & 48.5 &
59.6 & ▃▇▇▆▁ \\
bill\_depth\_mm & 0 & 1 & 17.15 & 1.97 & 13.1 & 15.60 & 17.30 & 18.7 &
21.5 & ▅▅▇▇▂ \\
flipper\_length\_mm & 0 & 1 & 200.92 & 14.02 & 172.0 & 190.00 & 197.00 &
213.0 & 231.0 & ▂▇▃▅▂ \\
body\_mass\_g & 0 & 1 & 4201.76 & 799.61 & 2700.0 & 3550.00 & 4050.00 &
4750.0 & 6300.0 & ▃▇▆▃▂ \\
\end{longtable}

\subsubsection{How could we be more sophisticated/clever about
imputation? Why would it
matter?}\label{how-could-we-be-more-sophisticatedclever-about-imputation-why-would-it-matter}

We could do something more complicated than just mean/mode. For example,
we could use a method like KNN to inform the imputation based on
\emph{similar} data points, not just all the data points. This could
potentially give us more accurate imputations closer to realistic
values.

\section{Short Tree}\label{short-tree}

\subsubsection{For the moment, let's focus on the possible splits of the
island variable. There are three islands. How many possible splits are
there?}\label{for-the-moment-lets-focus-on-the-possible-splits-of-the-island-variable.-there-are-three-islands.-how-many-possible-splits-are-there}

Only 3, as you can separate any 1 from the other 2.

\subsubsection{Try each split of island and then calculate the split's
(1) accuracy and (2)
gini.}\label{try-each-split-of-island-and-then-calculate-the-splits-1-accuracy-and-2-gini.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Find the islands}
\NormalTok{islands }\OtherTok{=}\NormalTok{ penguins}\SpecialCharTok{$}\NormalTok{island }\SpecialCharTok{|\textgreater{}} \FunctionTok{unique}\NormalTok{()}

\NormalTok{suppress }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\AttributeTok{X =}\NormalTok{ islands, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(i) \{}

\NormalTok{  grp1 }\OtherTok{=}\NormalTok{ penguins }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(island }\SpecialCharTok{==}\NormalTok{ i)}
\NormalTok{  grp2 }\OtherTok{=}\NormalTok{ penguins }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(island }\SpecialCharTok{!=}\NormalTok{ i)}
  \CommentTok{\# Find the modal species in each group}
\NormalTok{  species1 }\OtherTok{=}\NormalTok{ grp1}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{fmode}\NormalTok{()}
\NormalTok{  species2 }\OtherTok{=}\NormalTok{ grp2}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{fmode}\NormalTok{()}
  \CommentTok{\# Calculate accuracy}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Accuracy, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, }\FunctionTok{fmean}\NormalTok{(grp1}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==}\NormalTok{ species1)))}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Accuracy, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, }\FunctionTok{fmean}\NormalTok{(grp2}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==}\NormalTok{ species2)))}
  \CommentTok{\# Calculate gini}
\NormalTok{  g1 }\OtherTok{=}\NormalTok{ grp1}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{table}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \FunctionTok{prop.table}\NormalTok{()}
\NormalTok{  g2 }\OtherTok{=}\NormalTok{ grp2}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{table}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \FunctionTok{prop.table}\NormalTok{()}
\NormalTok{  gini1 }\OtherTok{=} \FunctionTok{sum}\NormalTok{(g1 }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ g1))}
\NormalTok{  gini2 }\OtherTok{=} \FunctionTok{sum}\NormalTok{(g2 }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ g2))}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Gini, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, (gini1 }\SpecialCharTok{+}\NormalTok{ gini2)}\SpecialCharTok{/}\DecValTok{2}\NormalTok{))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\subsubsection{Repeat 1.2 but for the sex
variable.}\label{repeat-1.2-but-for-the-sex-variable.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Find the sex}
\NormalTok{sex }\OtherTok{=}\NormalTok{ penguins}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{|\textgreater{}} \FunctionTok{unique}\NormalTok{()}

\NormalTok{suppress\_2 }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\AttributeTok{X =}\NormalTok{ sex, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(i) \{}

\NormalTok{  grp1 }\OtherTok{=}\NormalTok{ penguins }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(sex }\SpecialCharTok{==}\NormalTok{ i)}
\NormalTok{  grp2 }\OtherTok{=}\NormalTok{ penguins }\SpecialCharTok{|\textgreater{}} \FunctionTok{filter}\NormalTok{(sex }\SpecialCharTok{!=}\NormalTok{ i)}
  \CommentTok{\# Find the modal species in each group}
\NormalTok{  species1 }\OtherTok{=}\NormalTok{ grp1}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{fmode}\NormalTok{()}
\NormalTok{  species2 }\OtherTok{=}\NormalTok{ grp2}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{fmode}\NormalTok{()}
  \CommentTok{\# Calculate accuracy}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Accuracy, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, }\FunctionTok{fmean}\NormalTok{(grp1}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==}\NormalTok{ species1)))}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Accuracy, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, }\FunctionTok{fmean}\NormalTok{(grp2}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==}\NormalTok{ species2)))}
  \CommentTok{\# Calculate gini}
\NormalTok{  g1 }\OtherTok{=}\NormalTok{ grp1}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{table}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \FunctionTok{prop.table}\NormalTok{()}
\NormalTok{  g2 }\OtherTok{=}\NormalTok{ grp2}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{|\textgreater{}} \FunctionTok{table}\NormalTok{() }\SpecialCharTok{|\textgreater{}} \FunctionTok{prop.table}\NormalTok{()}
\NormalTok{  gini1 }\OtherTok{=} \FunctionTok{sum}\NormalTok{(g1 }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ g1))}
\NormalTok{  gini2 }\OtherTok{=} \FunctionTok{sum}\NormalTok{(g2 }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ g2))}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Gini, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, (gini1 }\SpecialCharTok{+}\NormalTok{ gini2)}\SpecialCharTok{/}\DecValTok{2}\NormalTok{))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

I have absolutely no idea why this is returning a third set of
statistics, as there are only two levels to the variable \textbf{sex}.

\subsubsection{Which variable and split would you make?
Why?}\label{which-variable-and-split-would-you-make-why}

I would split \textbf{island} by \emph{Biscoe} and \emph{Not Biscoe}, as
this seems to provide the best accuracy and similar Gini compared to
other splits.

\subsubsection{We would typically want to consider all possible splits
for the numeric variables as well. Explain (or code) an approach that
would try all of the splits for
bill\_length\_mm.}\label{we-would-typically-want-to-consider-all-possible-splits-for-the-numeric-variables-as-well.-explain-or-code-an-approach-that-would-try-all-of-the-splits-for-bill_length_mm.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Use imputed values}
\NormalTok{penguins }\OtherTok{\textless{}{-}}\NormalTok{ pen\_imp\_tidy}

\CommentTok{\# Define resolution}
\NormalTok{res }\OtherTok{=} \DecValTok{1}

\CommentTok{\# Define range}
\NormalTok{range }\OtherTok{=} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from=}\FunctionTok{min}\NormalTok{(penguins}\SpecialCharTok{$}\NormalTok{bill\_length\_mm),}\AttributeTok{to=}\NormalTok{(}\FunctionTok{max}\NormalTok{(penguins}\SpecialCharTok{$}\NormalTok{bill\_length\_mm)), }\AttributeTok{by =}\NormalTok{ res)}

\NormalTok{suppress\_3 }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\AttributeTok{X =}\NormalTok{ range, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(i) \{}
  
\NormalTok{  p\_low }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(bill\_length\_mm }\SpecialCharTok{\textless{}=}\NormalTok{ i)}
\NormalTok{  p\_high }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(bill\_length\_mm }\SpecialCharTok{\textgreater{}}\NormalTok{ i) }
\NormalTok{  mode\_low }\OtherTok{\textless{}{-}} \FunctionTok{Mode}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(p\_low}\SpecialCharTok{$}\NormalTok{species))}
\NormalTok{  mode\_high }\OtherTok{\textless{}{-}} \FunctionTok{Mode}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(p\_high}\SpecialCharTok{$}\NormalTok{species))}
\NormalTok{  acc\_df }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(bill\_length\_mm, species)}
\NormalTok{  acc\_df }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{pred =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(bill\_length\_mm }\SpecialCharTok{\textless{}=}\NormalTok{ i, mode\_low, mode\_high))}
\NormalTok{  ) }
  \FunctionTok{levels}\NormalTok{(acc\_df}\SpecialCharTok{$}\NormalTok{pred) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Adelie"}\NormalTok{, }\StringTok{"Chinstrap"}\NormalTok{,  }\StringTok{"Gentoo"}\NormalTok{)}
\NormalTok{  a }\OtherTok{=} \FunctionTok{accuracy}\NormalTok{(acc\_df, }\AttributeTok{truth =}\NormalTok{ species, }\AttributeTok{estimate =}\NormalTok{ pred)}
\NormalTok{  (}\FunctionTok{paste}\NormalTok{(}\StringTok{"Accuracy, "}\NormalTok{, i, }\StringTok{": "}\NormalTok{, a[}\DecValTok{3}\NormalTok{]))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\textbf{Bigger}
Tree}{Bigger Tree}}\label{bigger-tree}

\subsubsection{Use tidymodels to grow a tree (actually multiple trees).
Remember: We can (need to) tune the cost complexity (cost\_complexity)
to try to restrict the tree from
overfitting.}\label{use-tidymodels-to-grow-a-tree-actually-multiple-trees.-remember-we-can-need-to-tune-the-cost-complexity-cost_complexity-to-try-to-restrict-the-tree-from-overfitting.}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{981598345}\NormalTok{)}
\CommentTok{\# Reload data}
\FunctionTok{data}\NormalTok{(}\StringTok{\textquotesingle{}penguins\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Define Recipe}

\NormalTok{rec\_1 }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(penguins, species }\SpecialCharTok{\textasciitilde{}}\NormalTok{ island }\SpecialCharTok{+}\NormalTok{ sex }\SpecialCharTok{+}\NormalTok{ bill\_length\_mm) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{step\_impute\_mean}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{step\_impute\_mode}\NormalTok{(}\FunctionTok{all\_factor}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{update\_role}\NormalTok{(species, }\AttributeTok{new\_role =} \StringTok{"outcome"}\NormalTok{)}

\CommentTok{\# Define Model}

\NormalTok{mod\_1 }\OtherTok{\textless{}{-}} \FunctionTok{decision\_tree}\NormalTok{(}
  \AttributeTok{mode =} \StringTok{"classification"}\NormalTok{,}
  \AttributeTok{engine =} \StringTok{"rpart"}\NormalTok{,}
  \AttributeTok{cost\_complexity =} \FunctionTok{tune}\NormalTok{(),}
  \AttributeTok{tree\_depth =} \FunctionTok{tune}\NormalTok{(),}
  \AttributeTok{min\_n =} \FunctionTok{tune}\NormalTok{()}
\NormalTok{)}

\CommentTok{\# Define Workflow}

\NormalTok{wkfl\_1 }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_model}\NormalTok{(mod\_1) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{add\_recipe}\NormalTok{(rec\_1)}

\CommentTok{\# Cross Validation sets}
\NormalTok{nfold }\OtherTok{=} \DecValTok{5}
\NormalTok{peng\_cv }\OtherTok{\textless{}{-}}\NormalTok{ rec\_1 }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ prep }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ juice }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{vfold\_cv}\NormalTok{(}\AttributeTok{v =}\NormalTok{ nfold)}

\CommentTok{\# Parameter ranges}

\NormalTok{cost\_comp }\OtherTok{=} \DecValTok{10}\SpecialCharTok{\^{}}\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \SpecialCharTok{{-}}\DecValTok{4}\NormalTok{, }\AttributeTok{to =} \DecValTok{0}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.5}\NormalTok{)}
\NormalTok{depth }\OtherTok{=} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{to =} \DecValTok{15}\NormalTok{, }\AttributeTok{by =} \DecValTok{1}\NormalTok{)}
\NormalTok{mn }\OtherTok{=} \FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# Parellel}

\NormalTok{tgrid }\OtherTok{\textless{}{-}} \FunctionTok{expand\_grid}\NormalTok{(}
      \AttributeTok{cost\_complexity =}\NormalTok{ cost\_comp,}
      \AttributeTok{tree\_depth =}\NormalTok{ depth,}
      \AttributeTok{min\_n =}\NormalTok{ mn)}

\CommentTok{\# rf\_tuning = mclapply(}
\CommentTok{\#   x = 1:nrow(tgrid),}
\CommentTok{\#   FUN }
\CommentTok{\# )}

\CommentTok{\# cross validate}

\CommentTok{\# Detect the number of available cores}
\NormalTok{num\_cores }\OtherTok{\textless{}{-}} \FunctionTok{detectCores}\NormalTok{()}

\CommentTok{\# Register parallel backend}
\NormalTok{cl }\OtherTok{\textless{}{-}} \FunctionTok{makeCluster}\NormalTok{(num\_cores }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)}
\FunctionTok{registerDoParallel}\NormalTok{(cl)}

\NormalTok{cv }\OtherTok{\textless{}{-}}\NormalTok{ wkfl\_1 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{tune\_grid}\NormalTok{(}
\NormalTok{    peng\_cv,}
    \AttributeTok{grid =}\NormalTok{ tgrid,}
    \AttributeTok{metrics =} \FunctionTok{metric\_set}\NormalTok{(accuracy),}
    \AttributeTok{control =} \FunctionTok{control\_grid}\NormalTok{(}\AttributeTok{save\_pred =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{verbose =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{parallel\_over =} \StringTok{"everything"}\NormalTok{) }\CommentTok{\# Parellel}
\NormalTok{  )}

\NormalTok{fit\_1 }\OtherTok{\textless{}{-}}\NormalTok{ wkfl\_1 }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{finalize\_workflow}\NormalTok{(}\FunctionTok{select\_best}\NormalTok{(cv, }\AttributeTok{metric =} \StringTok{\textquotesingle{}accuracy\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{fit}\NormalTok{(}\AttributeTok{data =}\NormalTok{ penguins)}

\FunctionTok{rpart.plot}\NormalTok{(}
\NormalTok{  fit\_1}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\NormalTok{fit}\SpecialCharTok{$}\NormalTok{fit,}
  \AttributeTok{extra =} \DecValTok{104}\NormalTok{,}
  \AttributeTok{box.palette =} \StringTok{"RdPu"}\NormalTok{,}
  \AttributeTok{branch.lty =} \DecValTok{4}\NormalTok{,}
  \AttributeTok{shadow.col =} \StringTok{"gray"}\NormalTok{,}
  \AttributeTok{nn =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{cex =} \FloatTok{0.5}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{003_files/figure-latex/treeModel-1.pdf}

\end{document}
